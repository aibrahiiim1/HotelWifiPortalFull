@model HotelWifiPortal.Models.ViewModels.PaywallViewModel
@{
    Layout = null;
    var quotaExceeded = TempData["QuotaExceeded"] as bool? ?? false;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Limit Reached - Upgrade Your WiFi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            font-family: 'Segoe UI', sans-serif; 
        }
        .paywall-container { max-width: 1000px; margin: 0 auto; padding: 40px 20px; }
        .paywall-header { text-align: center; color: white; margin-bottom: 40px; }
        .paywall-header .icon { font-size: 4rem; margin-bottom: 20px; }
        .usage-card { 
            background: rgba(255,255,255,0.15); 
            border-radius: 20px; 
            padding: 30px; 
            margin-bottom: 30px; 
            backdrop-filter: blur(10px);
            color: white;
        }
        .usage-bar { 
            height: 20px; 
            background: rgba(255,255,255,0.2); 
            border-radius: 10px; 
            overflow: hidden; 
        }
        .usage-bar-fill { 
            height: 100%; 
            background: linear-gradient(90deg, #ff6b6b 0%, #ee5a24 100%); 
            border-radius: 10px; 
        }
        .card { border: none; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .package-option { 
            transition: transform 0.3s, box-shadow 0.3s; 
            cursor: pointer; 
            border: 3px solid transparent;
            height: 100%;
        }
        .package-option:hover { 
            transform: translateY(-10px); 
            box-shadow: 0 15px 40px rgba(0,0,0,0.2); 
        }
        .package-option.featured { 
            border-color: #28a745; 
            position: relative; 
        }
        .featured-badge { 
            position: absolute; 
            top: -1px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: #28a745; 
            color: white; 
            padding: 8px 25px; 
            border-radius: 0 0 15px 15px; 
            font-size: 0.8rem;
            font-weight: bold;
        }
        .price { font-size: 2.5rem; font-weight: 700; }
        .price-currency { font-size: 1.2rem; vertical-align: top; }
        .btn-buy { 
            border-radius: 50px; 
            padding: 12px 30px; 
            font-size: 1rem; 
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-buy:hover {
            transform: scale(1.05);
        }
        .package-features { 
            list-style: none; 
            padding: 0; 
            margin: 20px 0;
        }
        .package-features li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .package-features li:last-child {
            border-bottom: none;
        }
        .alert-quota {
            background: rgba(255,107,107,0.9);
            border: none;
            color: white;
        }
    </style>
</head>
<body>
    <div class="paywall-container">
        <div class="paywall-header">
            <i class="bi bi-wifi-off icon"></i>
            <h1 class="display-5 fw-bold">WiFi Data Limit Reached</h1>
            <p class="lead opacity-90">
                Your complimentary WiFi quota has been used up.
                <br />Choose a package below to continue browsing.
            </p>
        </div>

        <!-- Usage Summary Card -->
        <div class="usage-card">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h5><i class="bi bi-person-circle me-2"></i>Room @Model.Guest.RoomNumber</h5>
                    <p class="mb-2 opacity-75">@Model.Guest.GuestName</p>
                    <p class="mb-0">
                        <strong>@Model.UsedQuotaGB.ToString("F2") GB</strong> used of 
                        <strong>@Model.Guest.TotalQuotaGB.ToString("F2") GB</strong> quota
                    </p>
                </div>
                <div class="col-md-6">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Data Used</span>
                        <span>100%</span>
                    </div>
                    <div class="usage-bar">
                        <div class="usage-bar-fill" style="width: 100%"></div>
                    </div>
                    <p class="text-end mt-2 mb-0 opacity-75">
                        <i class="bi bi-exclamation-triangle me-1"></i>Quota exhausted
                    </p>
                </div>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <div class="alert alert-danger mb-4">
                <i class="bi bi-exclamation-circle me-2"></i>@Model.ErrorMessage
            </div>
        }

        @if (quotaExceeded)
        {
            <div class="alert alert-quota mb-4">
                <i class="bi bi-info-circle me-2"></i>
                <strong>Your WiFi access has been paused.</strong> 
                Purchase a package below to restore your internet connection immediately.
            </div>
        }

        <h4 class="text-white text-center mb-4">
            <i class="bi bi-cart-check me-2"></i>Choose Your Package
        </h4>

        <div class="row g-4 justify-content-center">
            @if (Model.AvailablePackages != null && Model.AvailablePackages.Any())
            {
                @foreach (var package in Model.AvailablePackages.OrderBy(p => p.Price))
                {
                    <div class="col-md-4">
                        <div class="card package-option h-100 @(package.IsFeatured ? "featured" : "")">
                            @if (package.IsFeatured)
                            {
                                <span class="featured-badge"><i class="bi bi-star-fill me-1"></i>BEST VALUE</span>
                            }
                            <div class="card-body text-center p-4 d-flex flex-column">
                                <div class="mb-3 mt-2">
                                    @{
                                        var iconName = package.PackageType == "RestOfStay" ? "calendar-check" : 
                                                      package.PackageType == "TimeBased" ? "clock" : "wifi";
                                        var badgeColor = package.IsFeatured ? "success" : 
                                                        package.PackageType == "RestOfStay" ? "primary" : "info";
                                    }
                                    <i class="bi bi-@iconName text-@badgeColor" style="font-size: 2.5rem;"></i>
                                </div>
                                <h4 class="fw-bold mb-1">@package.Name</h4>
                                <p class="text-muted small mb-3">@package.Description</p>
                                
                                <div class="price text-@badgeColor my-3">
                                    <span class="price-currency">@(package.Currency ?? "$")</span>@package.Price.ToString("F0")
                                </div>

                                <ul class="package-features text-start flex-grow-1">
                                    @if (package.PackageType == "TimeBased" && package.DurationDays.HasValue)
                                    {
                                        <li><i class="bi bi-check-circle-fill text-success me-2"></i>@package.DurationDays day(s) access</li>
                                    }
                                    else if (package.PackageType == "RestOfStay")
                                    {
                                        <li><i class="bi bi-check-circle-fill text-success me-2"></i>Access until checkout (@Model.Guest.DepartureDate.ToString("MMM dd"))</li>
                                    }
                                    @if (package.QuotaGB.HasValue && package.QuotaGB > 0)
                                    {
                                        <li><i class="bi bi-check-circle-fill text-success me-2"></i>@package.QuotaGB GB additional data</li>
                                    }
                                    else
                                    {
                                        <li><i class="bi bi-check-circle-fill text-success me-2"></i>Unlimited data</li>
                                    }
                                    @if (package.SpeedLimitKbps.HasValue && package.SpeedLimitKbps > 0)
                                    {
                                        <li><i class="bi bi-check-circle-fill text-success me-2"></i>Up to @(package.SpeedLimitKbps / 1000) Mbps speed</li>
                                    }
                                    <li><i class="bi bi-check-circle-fill text-success me-2"></i>Instant activation</li>
                                    <li><i class="bi bi-credit-card text-muted me-2"></i>Charged to room</li>
                                </ul>

                                <form asp-action="PurchasePackage" method="post" class="mt-auto">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="packageId" value="@package.Id" />
                                    <button type="submit" class="btn btn-@badgeColor btn-buy w-100"
                                            onclick="return confirm('Purchase @package.Name for @(package.Currency ?? "$")@package.Price?\n\nThis will be charged to Room @Model.Guest.RoomNumber and your WiFi will be restored immediately.');">
                                        <i class="bi bi-lightning-charge-fill me-2"></i>Buy Now
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12">
                    <div class="alert alert-warning text-center">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        No packages available. Please contact the front desk for assistance.
                    </div>
                </div>
            }
        </div>

        <div class="text-center mt-5">
            <p class="text-white opacity-75 mb-3">
                <i class="bi bi-shield-check me-1"></i>
                Secure payment - All charges go directly to Room @Model.Guest.RoomNumber
            </p>
            <p class="text-white opacity-50 small">
                <i class="bi bi-telephone me-1"></i>
                Need help? Call the front desk or dial 0 from your room
            </p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
